# Update the Apt repository at the start of a chef-client run
# https://docs.chef.io/resource_apt_update.html
apt_update 'update' do
  action :update
end

package 'git'
package 'i3'  # i3 window manager

# TODO: copy personal .i3 config into place
# TODO: Make it the default window manager
#  Maybe using: http://manpages.ubuntu.com/manpages/xenial/man1/choosewm.1.html

## Download Emacs and build from source, Emacs in source repos is old :(
package 'build-essential'
package 'libncurses5-dev'

remote_file '/tmp/emacs-25.1.tar.xz' do
  source 'https://mirrors.ocf.berkeley.edu/gnu/emacs/emacs-25.1.tar.xz'
  owner 'vagrant'
  group 'vagrant'
  mode '0755'
  action :create_if_missing
end

bash 'Untar emacs' do
  cwd '/tmp'
  code <<-EOH
    if [[ ! -f /usr/local/bin/emacs ]] ; then
      tar -Jxvf emacs-25.1.tar.xz
      cd emacs-25.1
      ./configure
      make
      make install
    fi
  EOH
end

git '/home/vagrant/.emacs.d' do
  repository 'git://github.com/syl20bnr/spacemacs.git'
  revision 'master'
  action :sync
end

# TODO: add my .spacemacs file

## Tools ##

package 'nmap'

directory '/home/vagrant/tools/' do
  owner 'vagrant'
  group 'vagrant'
  mode '0755'
  action :create
end

# Testssl.sh
# https://github.com/drwetter/testssl.sh
git '/home/vagrant/tools/testssl.sh' do
  repository 'git://github.com/drwetter/testssl.sh.git'
  revision '2.9dev'
  action :sync
end
